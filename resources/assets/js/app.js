
/**
 * First we will load all of this project's JavaScript dependencies which
 * includes Vue and other libraries. It is a great starting point when
 * building robust, powerful web applications using Vue and Laravel.
 */
console.clear();


require('./bootstrap');
window.Vue = require('vue');
import router from './routes';
Vue.component('appMain', require('./components/Main').default);

import BootstrapVue from 'bootstrap-vue'

Vue.use(BootstrapVue);

import VeeValidate from 'vee-validate';

Vue.use(VeeValidate);

import Snotify, { SnotifyPosition } from 'vue-snotify';
Vue.use(Snotify);


//logged in user restricting routes.. 

router.beforeEach((to,from,next)=>{
    if(to.matched.some(record => record.meta.alreadyLogged)){
        //this route req login 

        if(localStorage.getItem("loggedIn") === true)
        {   
            //User logged in
            app.$snotify.warning("Already logged in!",{
                position: SnotifyPosition.centerTop,
                backdrop:0.5,
            });

            next({
                path:"/home"
            })
        }
        else{
            next()
        }
    }
    else
    {
        //not the route needed login
        next();
    }
})

//forbid few routes for not logged in users 
router.beforeEach((to,from,next)=>{
    if(to.matched.some(record => record.meta.notLogged)){
        //this route req login 

        if(!localStorage.getItem("loggedIn"))
        {   
            //User logged in
            app.$snotify.error("Not available for visitors","Please login!",{
                position: SnotifyPosition.centerTop,
                backdrop:0.5,
            });

            next({
                path:"/home"
            })
        }
        else{
            next()
        }
    }
    else
    {
        //not the route needed login
        next();
    }
})

//visitors not allowed
router.beforeEach((to,from,next)=>{
    if(to.matched.some(record => record.meta.visitorNotAllowed)){
        //this route req login 

        if(!localStorage.getItem("loggedIn"))
        {   
            //User logged in
            app.$snotify.error("Not available for visitors","Please login!",{
                position: SnotifyPosition.centerTop,
                backdrop:0.5,
            });

            next({
                path:"/userlogin"
            })
        }
        else{
            next()
        }
    }
    else
    {
        //not the route needed login
        next();
    }
})

//didn't go through forgot
router.beforeEach((to,from,next)=>{
    if(to.matched.some(record => record.meta.NotOnForgot)){
        //this route req login 

        if(!localStorage.getItem("goneThroughForgotPw"))
        {   
            
            app.$snotify.error("Please go to forgot password","Error!",{
                position: SnotifyPosition.centerTop,
                backdrop:0.5,
            });

            next({
                path:"/home"
            })
        }
        else{
            next()
        }
    }
    else
    {
        //not the route needed login
        next();
    }
})

const app = new Vue({
    el: '#app',
    data:{
    },
    router
});

