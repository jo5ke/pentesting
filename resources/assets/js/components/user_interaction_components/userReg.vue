<template>
    <div id="loginContainer" class="container-fluid">
      <tool-header>
          <h4 slot="title">Register Form</h4>
          <p>Register with your credentials.</p>
      </tool-header>
      <app-form :options.sync="logForm" :regForm="reg"></app-form>
      
    </div>
</template>


<script>
import appForm from "../form_comps/appForm.vue";
import ToolHeader from "../comps_forEach_tool/ToolHeader.vue";
import { SnotifyPosition, SnotifyStyle } from "vue-snotify";

export default {
  components: {
    appForm,
    ToolHeader
  },
  data() {
    let vm = this;
    return {
      reg: true,
      logForm: {
        axiosSubmitForm() {
          axios
            .post("/userRegister", {
              email: vm.logForm.inputs.email.value,
              password: vm.logForm.inputs.pw.value,
              sameaspw: vm.logForm.inputs.pwagain.value,
              firstname: vm.logForm.inputs.firstname.value,
              lastname: vm.logForm.inputs.lastname.value
            })
            .then(function(response) {
              if (response.status === 200) {
                axios
                  .post("/userLogin", {
                    email: vm.logForm.inputs.email.value,
                    pw: vm.logForm.inputs.pw.value
                  })
                  .then(resp => {
                    //after login go to home and header should change
                    axios.get("/home").then(function(response) {
                      window.location = response.data.redirect;
                    });
                  });
              }
            })
            .catch(function(error) {
              vm.$snotify.error("User exists!", "Error!", {
                position: SnotifyPosition.centerTop,
                backdrop: 0.5
              });
            });
        },
        inputs: {
          email: {
            type: "text",
            id: "email",
            label: "e-mail address",
            value: "",
            validation: {
              required: true
            }
          },
          pw: {
            type: "password",
            id: "password",
            label: "password",
            value: "",
            validation: {
              required: true
            }
          },
          pwagain: {
            type: "password",
            id: "sameaspw",
            value: "",
            label: "repeat password",
            validation: {
              required: true
            }
          },
          firstname: {
            type: "text",
            id: "firstname",
            label: "Name",
            value: "",
            validation: {
              required: true
            }
          },
          lastname: {
            type: "text",
            id: "lastname",
            label: "Last Name",
            value: "",
            validation: {
              required: true
            }
          }
        },
        recaptchaToken: undefined
      }
    };
  },
  methods: {
    onCaptchaVerified() {}
  }
};
</script>


<style scoped>
h4 {
  text-align: center;
}
</style>
