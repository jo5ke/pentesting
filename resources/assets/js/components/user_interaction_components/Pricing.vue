<template>
  <div id="pricingContainer" class="row">

        <pricing-package class="col-lg-3 offset-lg-1 col-md-5 col-sm-8" :info="pricingPackages.info.daily">

        </pricing-package>
        
        <pricing-package class="col-lg-3 col-md-5 col-sm-8 " :info="pricingPackages.info.weekly">

        </pricing-package>

        <pricing-package class="col-lg-3 col-md-5 col-sm-8" :info="pricingPackages.info.monthly">

        </pricing-package>
        
  </div>
  


</template>

<script>
import eventBus from "../../eventBus";
import { SnotifyPosition, SnotifyStyle } from "vue-snotify";
import stripePlan from "../../mixins/checkStripePlan";

import PricingPackage from "../utilComps/PricingPackage.vue";
export default {
  mounted() {
    //check if already subscribed subscription

    this.checkStripePlan().then(plan => {
      eventBus.$emit("subscribed", plan);
    });

    eventBus.$on("packageSelected", packageName => {
      let firstCase = _.startCase(_.toLower(packageName));
      let lower = _.toLower(packageName);

      window.setTimeout(() => {
        let amount = this.pricingPackages.info[lower];
        amount = amount.onetime;
        amount = new Number(amount.slice(1));

        let formObj = {
          name: `${firstCase} package`,
          currency: "USD",

          token: token => {
            axios
              .post("payment", {
                package: lower,
                token: token,
                amount: amount
              })
              .then(resp => {
                let payment_success = resp.data !== "false";
                if (payment_success) {
                  eventBus.$emit("subscribed", firstCase);
                  eventBus.$emit("enableUnsub", true);
                  window.location.reload(true);
                }
              });
          }
        };

        //glitch forma
        amount *= 100;
        formObj.amount = amount;

        this.$checkout.open(formObj);
      }, 500);
    });
  },
  mixins: [stripePlan],
  data() {
    return {
      pricingPackages: {
        info: {
          
          daily: {
            free: false,
            title: "Daily",
            cost: "$3",
            onetime: ".95",
            yearly: "$950",
            capabilities :[
              "What happened to your father",
              "Have much respect for your father",
              "My father taught me many things "
            ]
          },
          weekly: {
            free: false,
            title: "Weekly",
            cost:"$10",
            onetime: ".95",
            yearly: "$499",
            capabilities :[
            "Toy mouse squeak roll",
            "I cry and cry and cry ",
            "Kitty ipsum dolor sit amet",
            "Soon as door open demand",
            "Ask for more so jump"
            ] 
          },
          monthly: {
            free: false,
            title: "Monthly",
            cost:"$49",
            onetime: ".99",
            yearly: "$540",
            capabilities :[
            "What happened to your father",
            "Have much respect for your father",
            "My father taught me many things ",
            "Toy mouse squeak roll",
            "I cry and cry and cry ",
            "Kitty ipsum dolor sit amet",
            "Soon as door open demand",
            "Ask for more so jump"
          ]
          }
        }
      }
    };
  },
  components: {
    PricingPackage
  }
};
</script>

<style scoped>
#pricingContainer {
  margin-top: 20px;
}
</style>
