<template>
  <div id="pricingContainer" class="row">

        <pricing-package class="col-lg-3 offset-lg-1 col-sm-5" :info="pricingPackages.info.daily">

        </pricing-package>
        
        <pricing-package class="col-lg-4 col-sm-5 " :info="pricingPackages.info.weekly">

        </pricing-package>

        <pricing-package class="col-lg-3 col-sm-5" :info="pricingPackages.info.monthly">

        </pricing-package>
  </div>
  


</template>

<script>
import eventBus from '../../eventBus';
import {SnotifyPosition, SnotifyStyle} from 'vue-snotify';

import PricingPackage from '../utilComps/PricingPackage.vue'
export default {
    mounted(){
        eventBus.$on("packageSelected",(packageName)=>{
            let firstCase = _.startCase(_.toLower(packageName));
            let lower = _.toLower(packageName);
            
             this.$snotify.success(`${firstCase} Package!`,"You selected:",{
                position: SnotifyPosition.centerTop,
                backdrop:0.5,
              });
            window.setTimeout(()=>{

                let amount = this.pricingPackages.info[lower];
                amount = amount.onetime;
                amount = new Number(amount.slice(1));

                 let formObj = {
                   name:`${firstCase} package`,
                   currency:'USD',

                    token:(token)=>{
                        eventBus.$emit("subscribed",firstCase);

                        axios.post('payment',
                        {
                            package:lower,
                            token: token,
                            amount : amount
                        })
                        .then((resp)=>{
                            console.log(resp);
                        });
                    } 
                }

                //glitch forma
                amount *= 100;
                formObj.amount = amount;

                this.$checkout.open(formObj)

            },1500)
                
        })

        
    },
    data(){
        return{
            
            pricingPackages:{
                
                info:
                {
                    free: {
                        free:true,
                        title:"Community",
                        onetime:"Free",
                        yearly:"24 hours"
                    },
                    daily: {
                        free:false,
                        title:"Daily",
                        onetime:"$3.95",
                        yearly:"$950"
                    },
                    weekly: {
                        free:false,
                        title:"Weekly",
                        onetime:"$10.95",
                        yearly:"$499"
                    },
                    monthly: {
                        free:false,
                        title:"Monthly",
                        onetime:"$49.99",
                        yearly:"$540"
                    },

                }

            }
        }
    },
    components:{
        PricingPackage
    }

  
}
</script>

<style scoped>
#pricingContainer{
    margin-top:20px;
}
</style>
