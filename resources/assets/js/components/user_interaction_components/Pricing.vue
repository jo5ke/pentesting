<template>
  <div id="pricingContainer" class="row">

        <pricing-package id="first" class="col-lg-3 offset-lg-0 offset-md-2 col-md-8 offset-sm-3  col-sm-6 offset-1 " :info="pricingPackages.info.lite">

        </pricing-package>
        
        <pricing-package class="col-lg-4 offset-lg-0 offset-1 col-md-8 offset-sm-3  col-sm-6 offset-md-2" :info="pricingPackages.info.premium">

        </pricing-package>

        <pricing-package class="col-lg-3 offset-lg-0 offset-1 col-md-8 offset-sm-3  col-sm-6 offset-md-2" :info="pricingPackages.info.pro">

        </pricing-package>
        
  </div>
  


</template>

<script>
import eventBus from "../../eventBus";
import { SnotifyPosition, SnotifyStyle } from "vue-snotify";
import stripePlan from "../../mixins/checkStripePlan";

import PricingPackage from "../utilComps/PricingPackage.vue";
export default {
  destroyed() {
    let cont = document.getElementById("contentContainer");
    cont.className = "row";
  },
  mounted() {
    let cont = document.getElementById("contentContainer");
    cont.className = "";

    //check if already subscribed subscription

    this.checkStripePlan().then(plan => {
      eventBus.$emit("subscribed", plan);
    });

    eventBus.$on("packageSelected", packageName => {
      let firstCase = _.startCase(_.toLower(packageName));
      let lower = _.toLower(packageName);

      window.setTimeout(() => {

        let amount = this.pricingPackages.info[lower];
        let cost = amount.cost;
        cost = cost.slice(1);

        amount = cost;
        amount = new Number(amount);
        
        let formObj = {
          name: `${firstCase} package`,
          currency: "USD",

          token: token => {
            axios
              .post("payment", {
                package: lower,
                token: token,
                amount: amount
              })
              .then(resp => {
                let payment_success = resp.data !== "false";
                if (payment_success) {
                  eventBus.$emit("subscribed", firstCase);
                  eventBus.$emit("enableUnsub", true);
                  window.location.reload(true);
                }
              });
          }
        };

        //glitch forma
        amount *= 100;
        formObj.amount = amount;

        this.$checkout.open(formObj);
      }, 500);
    });
  },
  mixins: [stripePlan],
  data() {
    return {
      pricingPackages: {
        info: {
          lite: {
            free: false,
            title: "Lite",
            cost: "$49",
            onetime: "/mo",
            yearly: "500 sites",
            capabilities: [
              "What happened to your father",
              "Have much respect for your father",
              "My father taught me many things "
            ]
          },
          premium: {
            free: false,
            title: "Premium",
            cost: "$150",
            onetime: "/mo",
            yearly: "1500 /week",
            capabilities: [
              "Toy mouse squeak roll",
              "I cry and cry and cry ",
              "Kitty ipsum dolor sit amet",
              "Soon as door open demand",
              "Ask for more so jump"
            ]
          },
          pro: {
            free: false,
            title: "Pro",
            cost: "$499",
            onetime: "/mo",
            yearly: "2500 /daily",
            capabilities: [
              "What happened to your father",
              "Have much respect for your father",
              "My father taught me many things ",
              "Toy mouse squeak roll",
              "I cry and cry and cry ",
              "Kitty ipsum dolor sit amet",
              "Soon as door open demand",
              "Ask for more so jump"
            ]
          }
        }
      }
    };
  },
  components: {
    PricingPackage
  }
};
</script>

<style scoped>

@media (min-width : 992px) {
  #first{
    margin-left: 6vw;
  }
}

#pricingContainer {
  margin: 0 auto;
  margin-top: 20px;
}
</style>
