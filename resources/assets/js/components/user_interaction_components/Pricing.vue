<template>
  <div id="pricingContainer" class="row">

        <pricing-package class="col-lg-3 offset-lg-1 col-md-5 col-sm-8" :info="pricingPackages.info.daily">

        </pricing-package>
        
        <pricing-package class="col-lg-3 col-md-5 col-sm-8 " :info="pricingPackages.info.weekly">

        </pricing-package>

        <pricing-package class="col-lg-3 col-md-5 col-sm-8" :info="pricingPackages.info.monthly">

        </pricing-package>
        
  </div>
  


</template>

<script>
import eventBus from "../../eventBus";
import { SnotifyPosition, SnotifyStyle } from "vue-snotify";
import stripePlan from "../../mixins/checkStripePlan";

import PricingPackage from "../utilComps/PricingPackage.vue";
export default {
  mounted() {
    //check if already subscribed subscription

    this.checkStripePlan().then(plan => {
      eventBus.$emit("subscribed", plan);
    });

    eventBus.$on("packageSelected", packageName => {
      let firstCase = _.startCase(_.toLower(packageName));
      let lower = _.toLower(packageName);

      window.setTimeout(() => {
        let amount = this.pricingPackages.info[lower];
        amount = amount.onetime;
        amount = new Number(amount.slice(1));

        let formObj = {
          name: `${firstCase} package`,
          currency: "USD",

          token: token => {
            axios
              .post("payment", {
                package: lower,
                token: token,
                amount: amount
              })
              .then(resp => {
                let payment_success = resp.data !== "false";
                if (payment_success) {
                  console.log("proso payment");
                  eventBus.$emit("subscribed", firstCase);
                  eventBus.$emit("enableUnsub", true);
                  window.location.reload(true);
                }
              });
          }
        };

        //glitch forma
        amount *= 100;
        formObj.amount = amount;

        this.$checkout.open(formObj);
      }, 500);
    });
  },
  mixins: [stripePlan],
  data() {
    return {
      pricingPackages: {
        info: {
          free: {
            free: true,
            title: "Community",
            onetime: "Free",
            yearly: "24 hours"
          },
          daily: {
            free: false,
            title: "Daily",
            onetime: "$3.95",
            yearly: "$950"
          },
          weekly: {
            free: false,
            title: "Weekly",
            onetime: "$10.95",
            yearly: "$499"
          },
          monthly: {
            free: false,
            title: "Monthly",
            onetime: "$49.99",
            yearly: "$540"
          }
        }
      }
    };
  },
  components: {
    PricingPackage
  }
};
</script>

<style scoped>
#pricingContainer {
  margin-top: 20px;
}
</style>
