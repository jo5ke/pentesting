<template>
    <div id="loginContainer" >
     
        
      <transition name="fade" mode="in-out">
     <form  class="fform" >
      <tool-header>
           <p>Leave your message and we will respond.</p>
      </tool-header>
        <!-- FIRST NAME -->

        <div  class="fform_input">
         
          <label :for="logForm.inputs.firstname.id">{{logForm.inputs.firstname.label}}</label>

          <input  
          :placeholder="logForm.inputs.firstname.label"
          :class="{'has-error':errName}"
          :type="logForm.inputs.firstname.type" 
          :id="logForm.inputs.firstname.id" 
          v-model="logForm.inputs.firstname.value" 
          :required="logForm.inputs.firstname.validation.required"
           v-validate="{
            rules:{
               required:true
            }}"
          :name="logForm.inputs.firstname.id"/>

          <span v-if="errors.has(logForm.inputs.firstname.id)" class="incorrect_input">
            Name required!
          </span>
        
        </div>

        <!-- EMAIL -->

        <div  class="fform_input">
         
          <label :for="logForm.inputs.email.id">{{logForm.inputs.email.label}}</label>

          <input  
          :placeholder="logForm.inputs.email.label"
          :class="{'has-error':errEmail}"
          :type="logForm.inputs.email.type" 
          :id="logForm.inputs.email.id" 
          v-model="logForm.inputs.email.value" 
          :required="logForm.inputs.email.validation.required"
           v-validate="{
            rules:{
               required:true,email:true
            }}"
          :name="logForm.inputs.email.id"/>

          <span v-if="errors.has(logForm.inputs.email.id)" class="incorrect_input">
            Email required!
          </span>
        
        </div>

        <!-- SUBJECT -->

        <div  class="fform_input">
         
          <label :for="logForm.inputs.subject.id">{{logForm.inputs.subject.label}}</label>

          <input  
          :placeholder="logForm.inputs.subject.label"
          :class="{'has-error':errSubject}"
          :type="logForm.inputs.subject.type" 
          :id="logForm.inputs.subject.id" 
          v-model="logForm.inputs.subject.value" 
          :required="logForm.inputs.subject.validation.required"
           v-validate="{
            rules:{
               required:true
            }}"
          :name="logForm.inputs.subject.id"/>

          <span v-if="errors.has(logForm.inputs.subject.id)" class="incorrect_input">
            Subject required!
          </span>
        
        </div>

        <!-- MESSAGE -->

        <div  class="fform_input">
         
          <label :for="logForm.inputs.message.id">{{logForm.inputs.message.label}}</label>

          <textarea  
          :placeholder="logForm.inputs.message.label"
          :class="{'has-error':errMessage}"
          :type="logForm.inputs.message.type" 
          :id="logForm.inputs.message.id" 
          v-model="logForm.inputs.message.value" 
          :required="logForm.inputs.message.validation.required"
           v-validate="{
            rules:{
               required:true
            }}"
          :name="logForm.inputs.message.id">
          
          </textarea>

          <span v-if="errors.has(logForm.inputs.message.id)" class="incorrect_input">
            Message required!
          </span>
        
        </div>
        
        
        <b-button id="contBtn" class="btn btn-info btn-secondary" @click="logForm.contactHandler()">
          Submit Message!
        </b-button>


    </form>

      </transition>

    </div>
</template>


<script>
import appForm from "../form_comps/appForm.vue";
import ToolHeader from "../comps_forEach_tool/ToolHeader.vue";
import { SnotifyPosition, SnotifyStyle } from "vue-snotify";

export default {
  components: {
    appForm,
    ToolHeader,
    SnotifyPosition,
    SnotifyStyle
  },
  computed: {
    errName() {
      return this.errors.has(this.logForm.inputs.firstname.id);
    },
    errEmail() {
      return this.errors.has(this.logForm.inputs.email.id);
    },
    errSubject() {
      return this.errors.has(this.logForm.inputs.subject.id);
    },
    errMessage() {
      return this.errors.has(this.logForm.inputs.message.id);
    }
  },
  beforeDestroy() {
    let nav = document.getElementById("header_navbar");
    nav.style.display = "";
  },
  mounted() {
    window.setTimeout(() => {
    this.isVisLoader = false;
    },2000);
    
    let nav = document.getElementById("header_navbar");
    nav.style.display = "none";
  },
  data() {
    let vm = this;
    return {
      isVisLoader : true,
      
      logForm: {
        contactHandler() {
          vm.$validator.validateAll().then(result => {
            if (result) {
              axios
                .post("/contact", {
                  email: vm.logForm.inputs.firstname.value,
                  firstname: vm.logForm.inputs.email.value,
                  subject: vm.logForm.inputs.subject.value,
                  message: vm.logForm.inputs.message.value
                })
                .then(function(response) {
                  console.log(response);
                  if (response.status === 200) {
                    vm.$snotify.success(
                      `${
                        vm.logForm.inputs.firstname.value
                      }, your message is sent!`,
                      "Sent!",
                      {
                        position: SnotifyPosition.centerTop,
                        backdrop: 0.5
                      }
                    );
                    vm.$router.push("/home");
                  }
                })
                .catch(function(error) {
                  vm.$snotify.error(
                    `${
                      vm.logForm.inputs.firstname.value
                    }, your message is not sent!`,
                    "Discarded!",
                    {
                      position: SnotifyPosition.centerTop,
                      backdrop: 0.5
                    }
                  );
                });
            } else {
              // snotify pop up da obavesti da nije popunjeno..
            }
          });
        },


        inputs: {
          firstname: {
            type: "text",
            id: "firstname",
            label: "Name",
            value: "",
            validation: {
              required: true
            }
          },
          email: {
            type: "text",
            id: "email",
            label: "E-mail address",
            value: "",
            validation: {
              required: true
            }
          },
          subject: {
            type: "text",
            id: "subject",
            label: "Subject",
            value: "",
            validation: {
              required: true
            }
          },
          message: {
            type: "text",
            id: "message",
            label: "Message",
            value: "Your message here...",
            validation: {
              required: true
            }
          }
        }
      }
    };
  }
};
</script>


<style scoped>
#loginContainer {
 
  background-color: #e3e3e3;
  width: 100vw;
  height: 110vh;
  margin-top: -5vh;
}

input:-webkit-autofill,
input:-webkit-autofill:hover,
input:-webkit-autofill:focus input:-webkit-autofill,
textarea:-webkit-autofill,
textarea:-webkit-autofill:hover textarea:-webkit-autofill:focus,
select:-webkit-autofill,
select:-webkit-autofill:hover,
select:-webkit-autofill:focus {
  -webkit-text-fill-color: rgb(8, 1, 22);
  transition: background-color 5000s ease-in-out 0s;
}

.btn {
  border-radius: 0%;
}

#contBtn {
  width: 100%;
}
textarea {
  text-align: center;
  outline: none !important;
  border-bottom: 1px solid rgba(0, 8, 53, 0.603);
  background-color: transparent;
  border: 0px;
  width: 100%;
  min-height: 80px;
}

.router-link-exact-active button {
  font-weight: bold;
  color: rgb(21, 56, 122);
}

.has-error {
  border: 1px solid rgba(255, 0, 0, 1);
}

.incorrect_input {
  float: left;
  width: 100%;
  color: red;
  font-size: 10px;
  font-weight: 700;
}
.fform {
  text-align: center;
  width: 22em;
  max-width: 100%;
  margin-left: auto;
  margin-right: auto;
  margin-top: 2em;
  padding-top: 1.5em;
  padding-bottom: 0.5em;
  -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.12),
    0 1px 1px rgba(0, 0, 0, 0.24);
  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.12), 0 1px 1px rgba(0, 0, 0, 0.24);
  font-size: 1rem;
}

.spinner {
  margin: 100px auto;
  width: 40px;
  height: 40px;
  position: relative;
}

.cube1,
.cube2 {
  background-color: #333;
  width: 15px;
  height: 15px;
  position: absolute;
  top: 0;
  left: 0;

  -webkit-animation: sk-cubemove 1.8s infinite ease-in-out;
  animation: sk-cubemove 1.8s infinite ease-in-out;
}

.cube2 {
  -webkit-animation-delay: -0.9s;
  animation-delay: -0.9s;
}

@-webkit-keyframes sk-cubemove {
  25% {
    -webkit-transform: translateX(42px) rotate(-90deg) scale(0.5);
  }
  50% {
    -webkit-transform: translateX(42px) translateY(42px) rotate(-180deg);
  }
  75% {
    -webkit-transform: translateX(0px) translateY(42px) rotate(-270deg)
      scale(0.5);
  }
  100% {
    -webkit-transform: rotate(-360deg);
  }
}

@keyframes sk-cubemove {
  25% {
    transform: translateX(42px) rotate(-90deg) scale(0.5);
    -webkit-transform: translateX(42px) rotate(-90deg) scale(0.5);
  }
  50% {
    transform: translateX(42px) translateY(42px) rotate(-179deg);
    -webkit-transform: translateX(42px) translateY(42px) rotate(-179deg);
  }
  50.1% {
    transform: translateX(42px) translateY(42px) rotate(-180deg);
    -webkit-transform: translateX(42px) translateY(42px) rotate(-180deg);
  }
  75% {
    transform: translateX(0px) translateY(42px) rotate(-270deg) scale(0.5);
    -webkit-transform: translateX(0px) translateY(42px) rotate(-270deg)
      scale(0.5);
  }
  100% {
    transform: rotate(-360deg);
    -webkit-transform: rotate(-360deg);
  }
}
/* app  input css */
.fform_input label {
  font-size: 15px;
  font-weight: 900;
  padding-right: 0.5rem;
  margin: auto;
}
.fform_input input {
  width: 95%;
  text-align: center;
  cursor: pointer;
  padding-left: 0;
  padding-right: 0;
}

.fform_input input:focus {
  cursor: text;
  width: 100%;
}

h4 {
  text-align: center;
}
</style>
