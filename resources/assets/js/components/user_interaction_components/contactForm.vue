<template>
    <div id="loginContainer" class="container-fluid">
      <tool-header>
          <h4 slot="title">Contact Form</h4>
           <p>Leave your email and message and we will respond as soon as we can.</p>
      </tool-header>
     <form class="fform" >

        <!-- FIRST NAME -->

        <div  class="fform_input">
         
          <label :for="logForm.inputs[0].id">{{logForm.inputs[0].label}}</label>

          <input  
          
          :class="{'has-error':errName}"
          :type="logForm.inputs[0].type" 
          :id="logForm.inputs[0].id" 
          v-model="logForm.inputs[0].value" 
          :required="logForm.inputs[0].validation.required"
           v-validate="{
            rules:{
               required:true
            }}"
          :name="logForm.inputs[0].id"/>

          <span v-if="errors.has(logForm.inputs[0].id)" class="incorrect_input">
            Name required!
          </span>
        
        </div>

        <!-- EMAIL -->

        <div  class="fform_input">
         
          <label :for="logForm.inputs[1].id">{{logForm.inputs[1].label}}</label>

          <input  
          
          :class="{'has-error':errEmail}"
          :type="logForm.inputs[1].type" 
          :id="logForm.inputs[1].id" 
          v-model="logForm.inputs[1].value" 
          :required="logForm.inputs[1].validation.required"
           v-validate="{
            rules:{
               required:true,email:true
            }}"
          :name="logForm.inputs[1].id"/>

          <span v-if="errors.has(logForm.inputs[1].id)" class="incorrect_input">
            Email required!
          </span>
        
        </div>

        <!-- SUBJECT -->

        <div  class="fform_input">
         
          <label :for="logForm.inputs[2].id">{{logForm.inputs[2].label}}</label>

          <input  
          
          :class="{'has-error':errSubject}"
          :type="logForm.inputs[2].type" 
          :id="logForm.inputs[2].id" 
          v-model="logForm.inputs[2].value" 
          :required="logForm.inputs[2].validation.required"
           v-validate="{
            rules:{
               required:true
            }}"
          :name="logForm.inputs[2].id"/>

          <span v-if="errors.has(logForm.inputs[2].id)" class="incorrect_input">
            Subject required!
          </span>
        
        </div>

        <!-- MESSAGE -->

        <div  class="fform_input">
         
          <label :for="logForm.inputs[3].id">{{logForm.inputs[3].label}}</label>

          <textarea  
          
          :class="{'has-error':errMessage}"
          :type="logForm.inputs[3].type" 
          :id="logForm.inputs[3].id" 
          v-model="logForm.inputs[3].value" 
          :required="logForm.inputs[3].validation.required"
           v-validate="{
            rules:{
               required:true
            }}"
          :name="logForm.inputs[3].id">
          
          </textarea>

          <span v-if="errors.has(logForm.inputs[3].id)" class="incorrect_input">
            Message required!
          </span>
        
        </div>
        
        
        <b-button @click="logForm.contactHandler()">
          Submit Message!
        </b-button>


    </form>


    </div>
</template>


<script>


import appForm from '../form_comps/appForm.vue';
import ToolHeader from '../comps_forEach_tool/ToolHeader.vue';
import {SnotifyPosition, SnotifyStyle} from 'vue-snotify';

export default {
  components:{
    appForm,ToolHeader,SnotifyPosition,SnotifyStyle
  },
  computed:{
      errName(){
        return this.errors.has(this.logForm.inputs[0].id);
      },
      errEmail(){
        return this.errors.has(this.logForm.inputs[1].id);
      },
      errSubject(){
        return this.errors.has(this.logForm.inputs[2].id);
      },
      errMessage(){
        return this.errors.has(this.logForm.inputs[3].id);
      }

  },
  data(){
  let vm = this;
   return{
     logForm:{
       contactHandler(){
        vm.$validator.validateAll().then(
        (result)=>
        {
            if(result)
            {
                axios.post("/contact",
                {
                    email:vm.logForm.inputs[0].value,
                    firstname : vm.logForm.inputs[1].value,
                    subject : vm.logForm.inputs[2].value,
                    message: vm.logForm.inputs[3].value
                }
                )
                .then(function (response) {
                  console.log(response);
                  if(response.status === 200)
                  {
                    vm.$snotify.success(`${vm.logForm.inputs[1].value}, your message is sent!`,"Sent!",{
                      position: SnotifyPosition.centerTop,
                      backdrop:0.5,
                    });
                    vm.$router.push("/home");  
                  }
                  else
                  {
                    //error on server
                    vm.$snotify.error('${vm.logForm.inputs[1].value}, your message is not sent!',"Discarded!",{
                      position: SnotifyPosition.centerTop,
                      backdrop:0.5
                  });
          }})
          .catch(function (error) {
            console.log(error);
          });
            }
            else{
                // snotify pop up da obavesti da nije popunjeno..  
            }
        }

        )


       },
       inputs:[
          {
            type: 'text',
            id: 'firstname',
            label: 'Name',
            value: 'John',
            validation: {
              required: true,
            },
          },
          {
            type: 'text',
            id: 'email',
            label: 'e-mail address',
            value: 'jon.doe@example.com',
            validation: {
              required: true,
            },
          },
          {
            type: 'text',
            id: 'subject',
            label: 'Subject',
            value: 'subject',
            validation: {
              required: true,
            },
          },
          {
            type: 'text',
            id: 'message',
            label: 'Message',
            value: 'Your message here...',
            validation: {
              required: true,
            },
          },
      ]
     }

    }
  }
}
</script>


<style scoped>

textarea{
    width: 100%;
    min-height:80px;
}

.router-link-exact-active button{
    font-weight: bold;
    color:rgb(21, 56, 122);
}

button 
{
    margin-top: 20px;
    color: #212529;
    background-color: #F0EDEE;
    border-radius: unset;
    border: 1px solid rgba(0, 0, 0, 0.125);
}
button:hover
{
    background-color: rgba(155, 155, 155, 0.849);
    border-radius: unset;
    border: 1px solid rgba(0, 0, 0, 0.125);
}
.has-error{
    box-shadow: 0 0 5px rgb(255, 0, 0);
    border: 1px solid rgba(255, 0, 0, 1);
}

.incorrect_input{
  float: left;
  width: 100%;
  color:red;
  font-size: 10px;
  font-weight: 700;
}
.fform {
  border-radius: 2%;
  text-align: center;
  width: 18em;
  max-width: 100%;
  margin-left: auto;
  margin-right: auto;
  margin-top: 2em;
  padding-left: 1em;
  padding-right: 1em;
  padding-top: 1.5em;
  padding-bottom: .5em;
  -webkit-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
  font-size: 1rem;
}

/* app  input css */
.fform_input label {
  font-size: 15px;
  font-weight: 900;
  padding-right: 0.5rem;
  margin: auto;
}
.fform_input input {
  width:90%;  
  text-align: center;
  cursor: pointer;
  padding-left: 0;
  padding-right: 0;
  background: none;
}

.fform_input input:focus {
  cursor: text;
}




h4{
  text-align: center;
}

</style>
