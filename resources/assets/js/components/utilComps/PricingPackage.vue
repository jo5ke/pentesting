<template>
  <div class="pricing">

    <div class="header">
        <h4>{{info.title}}</h4>
    </div>
    
    <div class="oneTime">
        <h4>One Time</h4>
        <p>{{info.onetime}}</p>
    </div>


    <div class="yearly">
        <h4 v-if="!info.free">Yearly</h4>
        <h4 v-else>Available</h4>
        
        <p class="text-muted">{{info.yearly}}</p>
    </div>
    
    <!-- show if not subscribed -->
    <b-button v-if="is_visible_sub_btn" id="btn" class="btn btn-info" @click.once="clickedPackage()">
        Get package! 
    </b-button>

    <!-- show if subscribed -->
    <b-button v-if="is_visible_unsub_btn" id="btn" class="btn btn-info" @click.once="cancelPackage()">
        Unsubscribe!
    </b-button>
    
</div>
</template>

<script>
import eventBus from '../../eventBus';
import {SnotifyPosition, SnotifyStyle} from 'vue-snotify';
export default {
    data(){
        return{
            is_visible_sub_btn:true,
            is_visible_unsub_btn: false,
            title:this.info.title,
            subbed: false
        }
    },
    mounted(){

        eventBus.$on("enableUnsub",()=>{
            //enable unsub payment gone through
            if ( this.subbed )
            {
                this.is_visible_sub_btn= false;
                this.is_visible_unsub_btn = true;
        
            }
        })

        eventBus.$on("subscribed",(title)=>{
            
            let package_match = title === this.info.title;
            console.log("title subscribed event ",title);
            if(package_match)
            {
                this.subbed = true;
                this.is_visible_sub_btn = false;
                this.is_visible_unsub_btn = true;

                let plan = document.querySelector('.subscription');
                plan.innerHTML = `${title}`;
            }   
            else
            {
                this.is_visible_sub_btn = true;
                this.is_visible_unsub_btn = false;
            }
                
            })
    },
    methods:{
        clickedPackage(){
            eventBus.$emit("packageSelected",this.title.toLowerCase())
        },
        cancelPackage(){
            axios.get("/cancle")
            .then((response)=>{
                if(response.status === 200 && this.subbed)
                {
                     this.$snotify.success(`You've canceled your ${this.title} plan`,`Unsubscribed!`,{
                        position: SnotifyPosition.centerTop,
                        backdrop:0.5,
                      });
                      this.is_visible_unsub_btn = false;
                      this.is_visible_sub_btn = true;
                }
            });
        }

    },
   props:{
       info:{
           type:Object
       }
   }
  
}
</script>

<style scoped>
#btn{
    margin-left: 0;
}
.pricing{
    width:fit-content;
    padding: 20px;
    text-align: center;
    margin-right: 25px;
    box-shadow: 1px 1px 1px 1px #ddd;
}
.pricing h4 {
    padding: 10px 0;
}
.pricing:first-of-type {
        border-top: 3px solid #3b2fda;
}
.pricing:nth-child(2) {
     border-top: 3px solid #29c74c;
}
.pricing:nth-child(3) {
      border-top: 3px solid #c7294c;
} 
.pricing:last-of-type {
      border-top: 3px solid #ecfb1f;
}
.header{
    border-bottom: 1px solid rgb(206, 205, 209);
    margin-bottom: 5%;
}


</style>
