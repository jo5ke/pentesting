<template>
    <div id="loginContainer" class="container-fluid">
      <tool-header>
          <h4 slot="title">Forgot Password</h4>
           <p>Use this form to get a new password.</p>
      </tool-header>
     <form class="fform" >


        <!-- EMAIL -->

        <div  class="fform_input">
         
          <label :for="logForm.inputs.email.id">{{logForm.inputs.email.label}}</label>

          <input  
          
          :class="{'has-error':errEmail}"
          :type="logForm.inputs.email.type" 
          :id="logForm.inputs.email.id" 
          v-model="logForm.inputs.email.value" 
          :required="logForm.inputs.email.validation.required"
           v-validate="{
            rules:{
               required:true,email:true
            }}"
          :name="logForm.inputs.email.id"/>

          <span v-if="errors.has(logForm.inputs.email.id)" class="incorrect_input">
            Email required!
          </span>
        
        </div>

        <b-button class="fixbtn btn btn-info btn-secondary" id="forgBtn" @click="logForm.contactHandler()">
          Submit!
        </b-button>


    </form>


    </div>
</template>


<script>


import appForm from '../form_comps/appForm.vue';
import ToolHeader from '../comps_forEach_tool/ToolHeader.vue';
import {SnotifyPosition, SnotifyStyle} from 'vue-snotify';

export default {
  components:{
    appForm,ToolHeader,SnotifyPosition,SnotifyStyle
  },
  computed:{
      
      errEmail(){
        return this.errors.has(this.logForm.inputs.email.id);
      }

  },
  data(){
  let vm = this;
   return{
     logForm:{
       contactHandler(){
        vm.$validator.validateAll().then(
        (result)=>
        {
            if(result)
            {
                axios.post("/forgotpw",
                {
                    email:vm.logForm.inputs.email.value
                }
                )
                .then(function (response) {
                    console.log(response)
                    if(response.data === 200)
                    {
                      localStorage.setItem("goneThroughForgotPw",true);
                      vm.$snotify.success(`Check ${vm.logForm.inputs.email.value} for reset link!`,"Email sent!",{
                        position: SnotifyPosition.centerTop,
                        backdrop:0.5,
                      });
                      vm.$router.push("/home");  
                    }
                    else   if(response.data === 404)
                    {
                      vm.$snotify.error("User doesn't exist!","Error!",{
                        position: SnotifyPosition.centerTop,
                        backdrop:0.5
                    });
              }
          })
          .catch(function (error) {
            console.log(error)
          });
          }
           
        }

        )


       },
       inputs:{
         
          "email":{
            type: 'text',
            id: 'email',
            label: 'E-mail address',
            value: 'jon.doe@example.com',
            validation: {
              required: true,
            }
          }
       }
     }

    }
  }
}
</script>


<style scoped>
#forgBtn{
  width: 100%;
}

.fixbtn{
  margin-top: 20px;
}

textarea{
    width: 100%;
    min-height:80px;
}

.router-link-exact-active button{
    font-weight: bold;
    color:rgb(21, 56, 122);
}


.has-error{
    box-shadow: 0 0 5px rgb(255, 0, 0);
    border: 1px solid rgb(146, 82, 82);
}

.incorrect_input{
  float: left;
  width: 100%;
  color:red;
  font-size: 10px;
  font-weight: 700;
}

/* app  input css */
.fform_input label {
  font-size: 15px;
  font-weight: 900;
  padding-right: 0.5rem;
  margin: auto;
}




h4{
  text-align: center;
}

</style>
