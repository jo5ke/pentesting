<template>
    <div id="loginContainer" class="container-fluid">

     <form class="fform" >
        <tool-header>
            <p>Input your email and new password.</p>
        </tool-header>

        <!-- EMAIL -->

        <div  class="fform_input">
         
          <label :for="logForm.inputs.email.id">{{logForm.inputs.email.label}}</label>

          <input  
          placeholder="Input your email!"
          :class="{'has-error':errEmail}"
          :type="logForm.inputs.email.type" 
          :id="logForm.inputs.email.id" 
          v-model="logForm.inputs.email.value" 
          :required="logForm.inputs.email.validation.required"
           v-validate="{
            rules:{
               required:true,email:true
            }}"
          :name="logForm.inputs.email.id"/>

          <span v-if="errors.has(logForm.inputs.email.id)" class="incorrect_input">
            Email required!
          </span>
        
        </div>


        <!-- PASSWORD INPUT  -->
        
        <div class="fform_input">
        
          <label :for="logForm.inputs.pw.id">{{logForm.inputs.pw.label}}</label>

          <input   
          
          placeholder="password"
          :class="{'has-error':errorPw}"
          :type="logForm.inputs.pw.type" 
          :id="logForm.inputs.pw.id" 
          v-model="logForm.inputs.pw.value" 
          :required="logForm.inputs.pw.validation.required"
          v-validate="{
            rules:{
            required:true,
            regex:/^(?=.*[A-Za-z])(?=.*\d)(?=.*[$@$!%*#?&])[A-Za-z\d$@$!%*#?&]{8,}$/}}"
          :name="logForm.inputs.pw.id"/>

          <span v-if="errors.has(logForm.inputs.pw.id)" class="incorrect_input">
            Min 8 characters, 1 letter, 1 number and 1 special character!
          </span>
       
        </div>

        <!-- SAME PW AGAIN  -->

        <div class="fform_input">
        
          <label :for="logForm.inputs.pwagain.id">{{logForm.inputs.pwagain.label}}</label>

          <input  
            placeholder="password again"

          :class="{'has-error':errorPwAgain}"
          :type="logForm.inputs.pwagain.type" 
          :id="logForm.inputs.pwagain.id" 
          v-model="logForm.inputs.pwagain.value" 
          :required="logForm.inputs.pwagain.validation.required"
           v-validate="{
             rules:{
             required:true,is:logForm.inputs.pw.value,
             regex:/^(?=.*[A-Za-z])(?=.*\d)(?=.*[$@$!%*#?&])[A-Za-z\d$@$!%*#?&]{8,}$/
            }}"
          :name="logForm.inputs.pwagain.id"/>
          <span v-if="errors.has(logForm.inputs.pwagain.id)" class="incorrect_input">
            Not the same password!
          </span>
        
        </div>

        <b-button class="fixbtn btn btn-info btn-secondary actionbtn" @click="logForm.contactHandler()">
          Submit!
        </b-button>


    </form>


    </div>
</template>


<script>
import appForm from "../form_comps/appForm.vue";
import ToolHeader from "../comps_forEach_tool/ToolHeader.vue";
import { SnotifyPosition, SnotifyStyle } from "vue-snotify";

export default {
  components: {
    appForm,
    ToolHeader,
    SnotifyPosition,
    SnotifyStyle
  },
  computed: {
    errEmail() {
      return this.errors.has(this.logForm.inputs.email.id);
    },
    errorPw() {
      return this.errors.has("password");
    },
    errorPwAgain() {
      return this.errors.has("sameaspw");
    }
  },
  beforeDestroy() {
    let nav = document.getElementById("header_navbar");
    nav.style.display = "";
  },
  mounted() {
    let nav = document.getElementById("header_navbar");
    nav.style.display = "none";
  },
  data() {
    let vm = this;
    return {
      logForm: {
        contactHandler() {
          vm.$validator.validateAll().then(result => {
            if (result) {
              axios
                .post("/resetpw", {
                  email: vm.logForm.inputs.email.value,
                  password: vm.logForm.inputs.pw.value,
                  sameaspw: vm.logForm.inputs.pwagain.value
                })
                .then(function(response) {
                  if (response.data === 200) {
                    vm.$snotify.success(
                      `You reseted your password!`,
                      "Success!",
                      {
                        position: SnotifyPosition.centerTop,
                        backdrop: 0.5
                      }
                    );
                    vm.$router.push("/home");
                  } else if (response.data === 404) {
                    vm.$snotify.error("User doesn't exist!", "Error!", {
                      position: SnotifyPosition.centerTop,
                      backdrop: 0.5
                    });
                  }
                })
                .catch(err => {
                  console.error(err);
                });
            }
          });
        },
        inputs: {
          email: {
            type: "text",
            id: "email",
            label: "E-mail address",
            value: "",
            validation: {
              required: true
            }
          },
          pw: {
            type: "password",
            id: "password",
            label: "New password",
            value: "",
            validation: {
              required: true
            }
          },
          pwagain: {
            type: "password",
            id: "sameaspw",
            value: "",
            label: "Repeat password",
            validation: {
              required: true
            }
          }
        }
      }
    };
  }
};
</script>


<style scoped>
#loginContainer {
  background-image: url("/images/log_reg.jpg");
  background-attachment: fixed;
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
  width: 100vw;
  height: 110vh;
  margin-left: -32px;
  margin-top: -5vh;
}

.fixbtn {
  margin-top: 20px;
}

textarea {
  width: 100%;
  min-height: 80px;
}

.router-link-exact-active button {
  font-weight: bold;
  color: rgb(21, 56, 122);
}

.has-error {
  box-shadow: 0 0 5px rgb(255, 0, 0);
  border: 1px solid rgba(255, 0, 0, 1);
}

.incorrect_input {
  float: left;
  width: 100%;
  color: red;
  font-size: 10px;
  font-weight: 700;
}
/* app  input css */
.fform_input label {
  font-size: 15px;
  font-weight: 900;
  padding-right: 0.5rem;
  margin: auto;
}

h4 {
  text-align: center;
}
</style>
